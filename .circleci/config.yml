version: 2.1

orbs:
  # IMPORTANT: Make sure this points to the version of the orb BEFORE we added the fix
  # (e.g., your 'main' branch or an older dev version if you have it)
  tbp: townerhale/tbp-orb-test@dev:alpha 

workflows:
  verify-failure-mode:
    jobs:
      - tbp/build-docker-amd:
          repo: dlc-test
          app_version: v1.0.0 
          dockerfile: Dockerfile.test
          environment: towner
          # We pass the args here to see if the ORIGINAL orb can handle them
          extra_build_args: "--cache-from type=registry,ref=${AWS_ECR_REGISTRY_ID}.dkr.ecr.us-east-1.amazonaws.com/dlc-test:cache --cache-to type=registry,ref=${AWS_ECR_REGISTRY_ID}.dkr.ecr.us-east-1.amazonaws.com/dlc-test:cache,mode=max"
          docker_layer_caching: true
          context:
            - aws-ecr